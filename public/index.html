<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nodevision Offline Toolbar</title>

  <!-- Stylesheets -->
  <link rel="stylesheet" href="MainStyles.css" />
  <link rel="stylesheet" href="LayoutStyles.css" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="GraphStyles.css" />
  <link rel="stylesheet" href="ToolbarStyles.css" />
  <link rel="stylesheet" href="NodeViewContainerStyles.css" />
</head>
<body style="height:100%; margin:0; display:flex; flex-direction:column;">

  <!-- Toolbar container at the top -->
  <div class="toolbar-container">
    <div class="toolbar"></div>
    <div id="sub-toolbar"></div>
  </div>

  <!-- Main split-pane area -->
  <div id="root" style="flex:1; display:flex; height:100%;"></div>

  <!-- React 17 UMD -->
  <script src="vendor/react/react.development.js"></script>
  <script src="vendor/react/react-dom.development.js"></script>

  <!-- Babel for JSX -->
  <script src="vendor/babel/babel.min.js"></script>

  <!-- Nodevision toolbar script -->
  <script src="createToolbar.js" type="text/javascript"></script>

  <script type="text/babel">
    function App() {
      const [selectedFileContent, setSelectedFileContent] = React.useState('');

      React.useEffect(() => {
        // === Split-pane resizing ===
        const divider = document.getElementById('divider');
        const containerLeft = divider.previousElementSibling;
        const containerRight = divider.nextElementSibling;
        let isResizing = false;

        const mouseMove = (e) => {
          if (!isResizing) return;
          const offsetRight = document.body.offsetWidth - e.clientX;
          containerLeft.style.width = `calc(100% - ${offsetRight}px)`;
          containerRight.style.width = `${offsetRight}px`;
        };
        const mouseUp = () => { isResizing = false; };
        divider.addEventListener('mousedown', () => { isResizing = true; });
        document.addEventListener('mousemove', mouseMove);
        document.addEventListener('mouseup', mouseUp);

        // === Initialize Nodevision toolbar ===
        if (window.createToolbar) window.createToolbar('.toolbar');
        if (window.loadFileView) window.loadFileView('#file-view-container');

        return () => {
          document.removeEventListener('mousemove', mouseMove);
          document.removeEventListener('mouseup', mouseUp);
        };
      }, []);

      // Open a file in the right pane
      const openFile = async (filePath) => {
        try {
          const resp = await fetch(`/api/files?path=${encodeURIComponent(filePath)}`);
          const data = await resp.text();
          setSelectedFileContent(data);
        } catch (err) {
          setSelectedFileContent(`Error loading file: ${err.message}`);
        }
      };

      return (
        <div style={{ display: 'flex', flex: 1, height: '100%' }}>
          {/* Left Pane: Navigation */}
          <div className="container container-left" style={{ width: '50%', backgroundColor: '#f9f9f9', overflowY: 'auto' }}>
           
            </div>

          {/* Divider */}
          <div className="divider" id="divider" style={{ width: '5px', backgroundColor: '#333', cursor: 'ew-resize', height: '100%' }}></div>

          {/* Right Pane: File viewer/editor */}
          <div className="container container-right" style={{ width: '50%', backgroundColor: '#e9e9e9', overflowY: 'auto', padding: '10px' }}>
            <div id="file-editor-container" style={{ whiteSpace: 'pre-wrap', fontFamily: 'monospace' }}>
              {selectedFileContent || 'Select a file in the left pane to view or edit'}
            </div>
          </div>
        </div>
      );
    }

    // Render React 17 app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
